<!DOCTYPE html>
<html>

<head>
    <title>Ray Tracer</title>
    <link rel="icon" href="data:,">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <script type="module">
        const size = { height: 512, width: 512 };
        const ctx = createContext(size);
        const renderer = new Worker(
            '../../build/worker/Renderer.worker.js',
            { type: 'module' });

        renderer.onmessage = event => {
            if (event.data.type !== 'row') { return; }

            const y = event.data.params.y;
            const buffer = event.data.params.buffer;
            const pixels = new Uint8ClampedArray(buffer);
            const imageData = new ImageData(pixels, pixels.length / 4);
            ctx.putImageData(imageData, 0, y);
        }

        renderer.postMessage({ type: 'render', params: { size } });

        function createContext(canvasSize) {
            const canvas = document.createElement('canvas');
            canvas.style.height = `${canvasSize.height}px`;
            canvas.style.width = `${canvasSize.width}px`;
            canvas.width = canvasSize.height;
            canvas.height = canvasSize.width;
            document.body.append(canvas);
            const context2d = canvas.getContext("2d");
            return context2d;
        }
    </script>
</body>

</html>
